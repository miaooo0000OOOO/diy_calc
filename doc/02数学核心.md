# 数学核心

## 记号

记号是表达式的最小单位，是构成表达式的不可分割的单元。

记号包括以下几类：

1. 操作数：整数，浮点数，变量
2. 一元运算符：负号，函数
3. 二元运算符：加减乘除幂模，等号
4. 运算控制符：左右括号

```c
typedef struct Token
{
    TokenType type; // 枚举 size 1B
    // 内存对齐填补 size 3B
    TokenValue v;   // 共用体 size 4B
} Token; // size 8B
```

## 词法分析器

词法分析器将输入的字符串表达式转化为记号序列，词法分析器是一个状态机，并且可以通过正则表达式（不完全地）描述。

之所以正则表达式无法描述词法规则，是因为其无法检测括号是否匹配，因此我的词法分析器由手工实现，通过将指针指向的字符和上一个字符作为状态机邻接矩阵的行和列来实现词法检查，同时通过栈记录括号是否匹配。

手动实现词法分析器的好处是可以实现灵活的错误处理，方便更改。

该词法分析器实现了词法规则检查，2、8、10、16进制整数和浮点数解析，括号匹配检测，分辨负号（一元运算符）和减号（二元运算符）

## 抽象语法树

抽象语法树是一个有三个指针的结构体，一个指针指向左子树，一个指针指向右子树，一个指针指向其所有的记号

当记号是一个操作数时，左右指针为空。

当记号是一元运算符时，右指针为空。

当记号是二元运算符时，左右都不为空。

## Partt Pasring

将记号序列转化为抽象语法树的算法为Pratt Parsing，相较于编译原理书中定义项和因子的方式来决定运算符的优先级，Partt Parsing通过引入约束力的概念，统一了运算符的优先级和结合律，被广泛应用在现代编程语言（如Rust）的表达式解析器中。


